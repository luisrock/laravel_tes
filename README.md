## Teses & S√∫mulas (Laravel Site)

### Prepare local

1. create db tes
2. import tes tables from production
3. clone repo
4. ``` mv laravel_tes [name] ```
5. ``` composer install ```
6. ``` npm install ```
7. ``` npm run dev ```
8. ``` cp .env.example .env ```

```
APP_NAME=[name]
APP_KEY=
APP_DEBUG=true
APP_URL=https://[name].test
DB_DATABASE=tes
DB_USERNAME=root
DB_PASSWORD=
```

9. ``` php artisan key:generate ```
10. ``` php artisan session:table ```
11. ``` php artisan migrate ```
12. ``` valet secure [name] ```

## API Documentation

### Autentica√ß√£o

A API utiliza autentica√ß√£o Bearer Token **apenas para os novos endpoints** de busca individual. Os endpoints de busca por termo n√£o requerem autentica√ß√£o.

Configure o token no arquivo `.env`:

```env
API_TOKEN=seu-token-secreto-aqui
```

### Headers Obrigat√≥rios

#### Para endpoints com autentica√ß√£o:
```
Authorization: Bearer seu-token-secreto-aqui
Content-Type: application/json
Accept: application/json
```

#### Para endpoints sem autentica√ß√£o:
```
Content-Type: application/json
Accept: application/json
```

### Endpoints

#### üîç 1. Busca por Termo (Sem Autentica√ß√£o)

**POST** `/api/`

**Par√¢metros:**
- `q` ou `keyword` (obrigat√≥rio, m√≠nimo 3 caracteres) - Termo de busca
- `tribunal` (obrigat√≥rio) - Tribunal/√≥rg√£o para pesquisa

**Exemplo:**
```bash
curl -X POST "https://teses.test/api/" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{
    "q": "medicamento",
    "tribunal": "STF"
  }'
```

**Resposta de Sucesso (200):**
```json
{
  "total_sum": 5,
  "total_rep": 3,
  "hits_sum": [
    {
      "trib_sum_titulo": "T√≠tulo da S√∫mula",
      "trib_sum_numero": "123",
      "trib_sum_texto": "Texto da s√∫mula...",
      "trib_sum_id": 456
    }
  ],
  "hits_rep": [
    {
      "trib_rep_titulo": "T√≠tulo da Tese",
      "trib_rep_tema": "Tema da tese",
      "trib_rep_tese": "Texto da tese...",
      "trib_rep_data": "01/01/2023",
      "trib_rep_id": 789
    }
  ]
}
```

#### üîç 2. Busca por Tribunal Espec√≠fico (Sem Autentica√ß√£o)

**POST** `/api/{tribunal}.php`

**Par√¢metros:**
- `q` ou `keyword` (obrigat√≥rio, m√≠nimo 3 caracteres) - Termo de busca
- `tribunal` (obrigat√≥rio) - Tribunal/√≥rg√£o para pesquisa

**Endpoints dispon√≠veis:**
- `POST /api/stf.php` - Busca STF
- `POST /api/stj.php` - Busca STJ
- `POST /api/tst.php` - Busca TST
- `POST /api/tcu.php` - Busca TCU
- `POST /api/tnu.php` - Busca TNU
- `POST /api/carf.php` - Busca CARF
- `POST /api/fonaje.php` - Busca FONAJE
- `POST /api/cej.php` - Busca CEJ

**Exemplo:**
```bash
curl -X POST "https://teses.test/api/stf.php" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{
    "q": "medicamento",
    "tribunal": "STF"
  }'
```

#### üîç 3. Buscar S√∫mula por N√∫mero (Com Autentica√ß√£o)

**GET** `/api/sumula/{tribunal}/{numero}`

**Par√¢metros:**
- `tribunal` (string): STF ou STJ
- `numero` (integer): N√∫mero da s√∫mula

**Exemplo:**
```bash
curl -X GET "https://teses.test/api/sumula/stf/269" \
  -H "Authorization: Bearer seu-token-secreto-aqui" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json"
```

**Resposta de Sucesso (200):**
```json
{
  "success": true,
  "data": {
    "id": 269,
    "numero": 269,
    "titulo": "S√∫mula 269",
    "texto": "O mandado de seguran√ßa n√£o √© substitutivo de a√ß√£o de cobran√ßa.",
    "aprovadaEm": "13/12/1963",
    "obs": "",
    "legis": "Constitui√ß√£o Federal de 1946, art. 141, ¬ß 24...",
    "precedentes": "RMS 6747 Publica√ß√µes: DJ de 27/06/1963...",
    "is_vinculante": 0,
    "link": "https://jurisprudencia.stf.jus.br/...",
    "seq": 269
  }
}
```

#### üîç 4. Buscar Tese por N√∫mero (Com Autentica√ß√£o)

**GET** `/api/tese/{tribunal}/{numero}`

**Par√¢metros:**
- `tribunal` (string): STF ou STJ
- `numero` (integer): N√∫mero da tese

**Exemplo:**
```bash
curl -X GET "https://teses.test/api/tese/stj/1303" \
  -H "Authorization: Bearer seu-token-secreto-aqui" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json"
```

**Resposta de Sucesso (200):**
```json
{
  "success": true,
  "data": {
    "id": 1608524,
    "numero": 1303,
    "orgao": "TERCEIRA SE√á√ÉO",
    "tema": "Definir se a aus√™ncia de confiss√£o pelo investigado...",
    "tese_texto": null,
    "ramos": "Furto",
    "atualizadaEm": "09/02/2025",
    "situacao": "Afetado"
  }
}
```

### C√≥digos de Status HTTP

- **200**: Sucesso
- **400**: Par√¢metros inv√°lidos
- **401**: Token de autentica√ß√£o inv√°lido ou n√£o fornecido (apenas endpoints com autentica√ß√£o)
- **404**: S√∫mula/Tese n√£o encontrada

### Tribunais Suportados

#### Busca por Termo (Todos os Tribunais):
- **STF** - S√∫mulas e Teses
- **STJ** - S√∫mulas e Teses
- **TST** - S√∫mulas e Teses
- **TNU** - S√∫mulas e Quest√µes de Ordem
- **TCU** - Via API externa
- **CARF** - S√∫mulas
- **FONAJE** - S√∫mulas
- **CEJ** - S√∫mulas

#### Busca Individual (Apenas STF e STJ):
- **STF**: S√∫mulas e Teses
- **STJ**: S√∫mulas e Teses

### Estrutura das Tabelas

#### STF
- **S√∫mulas**: `stf_sumulas`
- **Teses**: `stf_teses`

#### STJ
- **S√∫mulas**: `stj_sumulas`
- **Teses**: `stj_teses`

### Configura√ß√£o do Token

1. **Local**: Adicione ao arquivo `.env`:
```env
API_TOKEN=seu-token-secreto-aqui
```

2. **Produ√ß√£o**: Configure no painel do Forge (Environment Variables):
```env
API_TOKEN=seu-token-secreto-producao
```

3. **Seguran√ßa**: Use tokens diferentes para local e produ√ß√£o.

### Exemplos de Uso

#### Busca por Termo (Sem Autentica√ß√£o)
```bash
# Buscar "medicamento" no STF
curl -X POST "https://teses.test/api/" \
  -H "Content-Type: application/json" \
  -H "Accept: application/json" \
  -d '{"q": "medicamento", "tribunal": "STF"}'
```

#### Busca Individual (Com Autentica√ß√£o)
```bash
# Buscar s√∫mula 269 do STF
curl -X GET "https://teses.test/api/sumula/stf/269" \
  -H "Authorization: Bearer seu-token" \
  -H "Content-Type: application/json"

# Buscar tese 1234 do STF
curl -X GET "https://teses.test/api/tese/stf/1234" \
  -H "Authorization: Bearer seu-token" \
  -H "Content-Type: application/json"
```

### Compatibilidade

- ‚úÖ **Endpoints existentes** continuam funcionando sem autentica√ß√£o
- ‚úÖ **Extens√£o Chrome** continua funcionando normalmente
- ‚úÖ **Nova funcionalidade** requer autentica√ß√£o Bearer Token
- ‚úÖ **Valida√ß√µes robustas** em todos os endpoints
- ‚úÖ **Mensagens de erro** em portugu√™s

### Rate Limiting

A API possui rate limiting configurado pelo Laravel para prevenir abuso. Consulte a documenta√ß√£o do Laravel para mais detalhes sobre configura√ß√£o de throttling.
