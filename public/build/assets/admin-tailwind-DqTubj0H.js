(function(t){let h=1,f=60,g="not_created",m="results",b="desc",p="",C=window.adminRoutes?window.adminRoutes.store:"/admin-ajax-request",P=window.adminRoutes?window.adminRoutes.delete:"/admin-ajax-request-del",T=window.adminRoutes?window.adminRoutes.getTemas:"/admin/get-temas";const x=document.querySelector('meta[name="csrf-token"]').getAttribute("content");function y(n,a=3){for(var s=n.toLowerCase().split(" "),e=0;e<s.length;e++)s[e].length<a||(s[e]=s[e].charAt(0).toUpperCase()+s[e].substring(1));return s.join(" ")}function w(n){if(!n)return"";const a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return n.toString().replace(/[&<>"']/g,function(s){return a[s]})}function v(n){return n.replace(/^["']|["']$/g,"").trim()}function _(n,a){let s;return function(...r){const d=()=>{clearTimeout(s),n(...r)};clearTimeout(s),s=setTimeout(d,a)}}t(document).ready(function(){console.log("Admin Dashboard Tailwind JS carregado!"),q(),u()});function u(){R();const n={page:h,per_page:f,filter_status:g,order_by:m,order_direction:b,search:p};t.ajax({url:T,type:"GET",data:n,success:function(a){a.success&&(S(a.data),E(a.pagination),j(a.pagination))},error:function(a,s,e){console.error("Erro ao carregar temas:",e),t("#temas-container").html('<div class="tw-p-4 tw-bg-red-50 tw-text-red-700 tw-rounded-lg">Erro ao carregar temas. Por favor, recarregue a página.</div>')}})}function S(n){if(n.length===0){t("#temas-container").html('<div class="tw-p-4 tw-bg-blue-50 tw-text-blue-700 tw-rounded-lg">Nenhum tema encontrado com os filtros selecionados.</div>'),t("#pagination-container").hide();return}let a='<div class="tw-overflow-x-auto tw-rounded-lg tw-shadow tw-border tw-border-gray-200"><table class="tw-min-w-full tw-divide-y tw-divide-gray-200"><thead class="tw-bg-gray-50"><tr>';const s="tw-px-6 tw-py-3 tw-text-left tw-text-xs tw-font-medium tw-text-gray-500 tw-uppercase tw-tracking-wider";a+=`<th class="${s} tw-w-10">
                    <input type="checkbox" id="select-all-header" class="tw-rounded tw-border-gray-300 tw-text-brand-600 focus:tw-ring-brand-500">
                </th>`,a+=`<th class="${s} tw-w-16">ID</th>`,a+=`<th class="${s}">Keyword</th>`,a+=`<th class="${s}">Label</th>`,a+=`<th class="${s} tw-w-24 tw-text-center">Resultados</th>`,a+=`<th class="${s} tw-w-32">Criado em</th>`,a+=`<th class="${s} tw-w-48">Ações</th>`,a+='</tr></thead><tbody class="tw-bg-white tw-divide-y tw-divide-gray-200">',n.forEach((e,r)=>{const d=e.created_at&&e.slug,c=d?"hide-created tw-bg-green-50":"tw-hover:bg-gray-50";let i=e.label;if(!i){const D=v(e.keyword);i=y(D)}const o=d?`<a href="/tema/${e.slug}" target="_blank" class="tw-text-brand-600 hover:tw-underline">${w(e.keyword)} <i class="fas fa-external-link-alt tw-text-xs tw-ml-1"></i></a>`:w(e.keyword),l="tw-px-6 tw-py-4 tw-whitespace-nowrap tw-text-sm tw-text-gray-900";a+=`
                <tr id="td-tema-${e.id}" class="td-tema ${c}" data-tema-id="${e.id}">
                    <td class="${l}">
                        <input type="checkbox" class="tema-checkbox tw-rounded tw-border-gray-300 tw-text-brand-600 focus:tw-ring-brand-500" data-tema-id="${e.id}">
                    </td>
                    <td class="${l} tw-text-gray-500">${e.id}</td>
                    <td class="${l} tw-max-w-xs tw-truncate" title="${w(e.keyword)}">${o}</td>
                    <td class="${l} tw-max-w-xs tw-truncate" title="${w(i)}">${w(i)}</td>
                    <td class="${l} tw-text-center">
                        <span class="tw-px-2 tw-inline-flex tw-text-xs tw-leading-5 tw-font-semibold tw-rounded-full tw-bg-gray-100 tw-text-gray-800">
                            ${e.results}
                        </span>
                    </td>
                    <td class="${l} tw-text-gray-500 tw-text-xs">${e.created_at||"-"}</td>
                    <td class="${l}">
                        <div id="div-create-${r}" ${d?'style="display:none"':""}>
                            <button class="btn-create tw-inline-flex tw-items-center tw-px-3 tw-py-1.5 tw-border tw-border-transparent tw-text-xs tw-font-medium tw-rounded-md tw-text-white tw-bg-emerald-600 hover:tw-bg-emerald-700 focus:tw-outline-none focus:tw-ring-2 focus:tw-ring-offset-2 focus:tw-ring-emerald-500" 
                                data-id="${e.id}" data-keyword="${w(e.keyword)}" data-index="${r}">
                                <i class="fa fa-plus-circle tw-mr-1.5"></i> Criar
                            </button>
                        </div>
                        <div id="div-create-label-${r}" style="display:none" class="tw-flex tw-flex-col tw-gap-2">
                            <input type="text" id="create-input-${e.id}" class="tw-block tw-w-full tw-rounded-md tw-border-gray-300 tw-shadow-sm focus:tw-border-brand-500 focus:tw-ring-brand-500 tw-sm:text-sm" placeholder="Label..." value="${w(i)}">
                            <div class="tw-flex tw-gap-2">
                                <button class="btn-submit-create tw-inline-flex tw-items-center tw-px-2.5 tw-py-1.5 tw-border tw-border-transparent tw-text-xs tw-font-medium tw-rounded tw-text-white tw-bg-brand-600 hover:tw-bg-brand-700" data-id="${e.id}" data-index="${r}">
                                    <i class="fa fa-check"></i>
                                </button>
                                <button class="btn-cancel-create tw-inline-flex tw-items-center tw-px-2.5 tw-py-1.5 tw-border tw-border-gray-300 tw-text-xs tw-font-medium tw-rounded tw-text-gray-700 tw-bg-white hover:tw-bg-gray-50" data-index="${r}">
                                    <i class="fa fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </td>
                </tr>
            `}),a+="</tbody></table></div>",t("#temas-container").html(a),k()}function E(n){if(n.last_page<=1){t("#pagination-container").hide();return}t("#pagination-container").show();const a=`Exibindo <span class="tw-font-medium">${n.from}</span> a <span class="tw-font-medium">${n.to}</span> de <span class="tw-font-medium">${n.total}</span> temas`;t("#pagination-info").html(a);let s='<nav class="tw-relative tw-z-0 tw-inline-flex tw-rounded-md tw-shadow-sm -tw-space-x-px" aria-label="Pagination">';const e=n.current_page,r=n.last_page,d="tw-relative tw-inline-flex tw-items-center tw-px-2 tw-py-2 tw-border tw-border-gray-300 tw-bg-white tw-text-sm tw-font-medium tw-text-gray-500 hover:tw-bg-gray-50",c="tw-relative tw-inline-flex tw-items-center tw-px-2 tw-py-2 tw-border tw-border-gray-300 tw-bg-gray-100 tw-text-gray-400 tw-cursor-not-allowed";s+=`<button ${e===1?'disabled class="'+c+' tw-rounded-l-md"':'class="'+d+' tw-rounded-l-md" onclick="changePage(1)"'}>
            <span class="tw-sr-only">Primeira</span> <i class="fas fa-angle-double-left"></i>
        </button>`,s+=`<button ${e===1?'disabled class="'+c+'"':'class="'+d+'" onclick="changePage('+(e-1)+')"'}>
            <span class="tw-sr-only">Anterior</span> <i class="fas fa-angle-left"></i>
        </button>`;let i=[];if(r<=10)for(let o=1;o<=r;o++)i.push(o);else if(i.push(1),e<=4){for(let o=2;o<=5;o++)i.push(o);i.push("..."),i.push(r)}else if(e>=r-3){i.push("...");for(let o=r-4;o<=r;o++)i.push(o)}else i.push("..."),i.push(e-1),i.push(e),i.push(e+1),i.push("..."),i.push(r);i.forEach(o=>{o==="..."?s+='<span class="tw-relative tw-inline-flex tw-items-center tw-px-4 tw-py-2 tw-border tw-border-gray-300 tw-bg-white tw-text-sm tw-font-medium tw-text-gray-700">...</span>':s+=`<button class="tw-relative tw-inline-flex tw-items-center tw-px-4 tw-py-2 tw-border tw-text-sm tw-font-medium ${o===e?"tw-z-10 tw-bg-brand-50 tw-border-brand-500 tw-text-brand-600":"tw-bg-white tw-border-gray-300 tw-text-gray-500 hover:tw-bg-gray-50"}" onclick="changePage(${o})">${o}</button>`}),s+=`<button ${e===r?'disabled class="'+c+'"':'class="'+d+'" onclick="changePage('+(e+1)+')"'}>
            <span class="tw-sr-only">Próxima</span> <i class="fas fa-angle-right"></i>
        </button>`,s+=`<button ${e===r?'disabled class="'+c+' tw-rounded-r-md"':'class="'+d+' tw-rounded-r-md" onclick="changePage('+r+')"'}>
            <span class="tw-sr-only">Última</span> <i class="fas fa-angle-double-right"></i>
        </button>`,s+="</nav>",t("#pagination-controls").html(s)}function j(n){t("#stat-showing").text(n.total)}function R(){t("#temas-container").html(`
            <div class="tw-flex tw-justify-center tw-items-center tw-p-12">
                <i class="fas fa-spinner fa-spin tw-text-brand-600 tw-text-3xl tw-mr-3"></i>
                <span class="tw-text-gray-600 tw-text-lg">Carregando temas...</span>
            </div>
        `),t("#pagination-container").hide()}window.changePage=function(n){h=n,u()};function q(){t("#per-page, #filter-status, #order-by, #order-direction").on("change",function(){this.id==="per-page"?f=parseInt(t(this).val()):this.id==="filter-status"?g=t(this).val():this.id==="order-by"?m=t(this).val():this.id==="order-direction"&&(b=t(this).val()),h=1,u()});const n=_(function(){p=t("#search-input").val(),h=1,u()},500);t("#search-input").on("keyup",n),t(document).on("change",".tema-checkbox",function(){const a=t(this).closest("tr");t(this).is(":checked")?a.addClass("tw-bg-blue-50"):(a.removeClass("tw-bg-blue-50"),a.hasClass("hide-created")&&a.addClass("tw-bg-green-50")),k()}),t(document).on("change","#select-all-header",function(){t(".tema-checkbox").prop("checked",t(this).is(":checked")).trigger("change")}),t("#select-all-page").on("click",function(){t(".tema-checkbox").prop("checked",!0).trigger("change")}),t("#deselect-all").on("click",function(){t(".tema-checkbox").prop("checked",!1).trigger("change")}),t("#delete-selected").on("click",A),t(document).on("click",".btn-create",function(){const a=t(this).data("index"),s=t(this).data("id"),e=t(this).data("keyword");t("#div-create-"+a).hide(),t("#div-create-label-"+a).show();const r=t("#create-input-"+s),d=r.val();if(!d||d.startsWith('"')||d.startsWith("'")){const c=v(e);r.val(y(c))}r.focus()}),t(document).on("click",".btn-cancel-create",function(){const a=t(this).data("index");t("#div-create-"+a).show(),t("#div-create-label-"+a).hide()}),t(document).on("click",".btn-submit-create",function(){const a=t(this).data("id"),s=t(this).data("index"),e=t("#create-input-"+a).val().trim(),r=t(this);if(!e){alert("Por favor, digite um label para a página.");return}const d={id:a,label:e,create:1,_token:x};r.prop("disabled",!0).html('<i class="fas fa-spinner fa-spin"></i>'),t.ajax({url:C,type:"POST",data:d,success:function(c){c.hasOwnProperty("success")&&c.success==1&&(t("#div-create-"+s).hide(),t("#div-create-label-"+s).hide(),t("#td-tema-"+a).addClass("hide-created tw-bg-green-50"),u())},error:function(c,i,o){console.error("Erro ao criar página:",o),alert("Erro ao criar página."),r.prop("disabled",!1).html('<i class="fa fa-check"></i>')}})}),t("#toggle-created").on("click",function(){const a=t(".hide-created");a.is(":hidden")?(a.show(),t(this).text("Esconder criados")):(a.hide(),t(this).text("Mostrar criados"))})}function k(){const n=t(".tema-checkbox:checked").length;t("#selected-count").text(n),n>0?t("#batch-actions").removeClass("tw-hidden"):t("#batch-actions").addClass("tw-hidden")}function A(){const n=[];if(t(".tema-checkbox:checked").each(function(){n.push(t(this).data("tema-id"))}),n.length===0||!confirm(`Tem certeza que deseja deletar ${n.length} temas? Esta ação não pode ser desfeita.`))return;const a=t("#delete-selected"),s=a.html();a.prop("disabled",!0).html('<i class="fas fa-spinner fa-spin"></i> Deletando...');let e=0,r=0;const d=n.map(c=>t.ajax({url:P,type:"POST",data:{id:c,_token:x}}).then(()=>e++,()=>r++));Promise.all(d).finally(function(){a.prop("disabled",!1).html(s),alert(`Concluído! ${e} deletados, ${r} erros.`),u(),t("#select-all-header").prop("checked",!1)})}})(jQuery);
